<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>OMR 全圖座標驗證</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: sans-serif;
            background-color: #e9ecef;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        /* 頂部控制列 */
        .toolbar {
            width: 100%;
            max-width: 1200px;
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        /* 畫布容器：確保不分割且完整顯示 */
        #canvas-container {
            width: 100%;
            display: flex;
            justify-content: center;
            overflow: hidden;
        }
        canvas {
            /* 關鍵：確保圖形完整縮放顯示在螢幕內 */
            max-width: 100%;
            height: auto; 
            border: 2px solid #333;
            background-color: white;
            box-shadow: 0 5px 25px rgba(0,0,0,0.2);
        }
        .btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn:hover { background: #218838; }
        .stats { font-size: 14px; color: #555; }
    </style>
</head>
<body>

    <div class="toolbar">
        <div>
            <strong style="font-size: 1.2em;">答案卡完整預覽</strong>
            <span class="stats" id="infoText"> — 請上傳圖檔</span>
        </div>
        <label for="imageInput" class="btn">選取答案卡圖片</label>
        <input type="file" id="imageInput" accept="image/*" style="display:none">
    </div>

    <div id="canvas-container">
        <canvas id="omrCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('omrCanvas');
        const ctx = canvas.getContext('2d');
        const imageInput = document.getElementById('imageInput');

        // 定位點數據
        const anchorData = [
            ["定位-左上", 70, 67, 60, 53],
            ["定位-右上", 1808, 67, 60, 53],
            ["定位-左下", 70, 2080, 60, 53],
            ["定位-右下", 1808, 2080, 60, 53]
        ];



        // 泡泡數據字串 (CSV 格式)
        const bubbleDataRaw = `
1,213,739,19,第1題的A,
2,268,740,20,第1題的B,
3,322,740,20,第1題的C,
4,377,739,18,第1題的D,
5,430,739,20,第1題的E,
6,214,801,19,第2題的A,
7,268,802,19,第2題的B,
8,321,801,20,第2題的C,
9,377,801,20,第2題的D,
10,432,801,19,第2題的E,
11,214,864,21,第3題的A,
12,268,864,21,第3題的B,
13,322,864,21,第3題的C,
14,377,866,20,第3題的D,
15,432,865,19,第3題的E,
16,214,927,19,第4題的A,
17,268,928,19,第4題的B,
18,324,927,20,第4題的C,
19,377,926,20,第4題的D,
20,432,927,19,第4題的E,
21,213,991,21,第5題的A,
22,267,991,21,第5題的B,
23,322,991,19,第5題的C,
24,377,989,20,第5題的D,
25,431,991,21,第5題的E,
26,214,1055,19,第6題的A,
27,268,1056,20,第6題的B,
28,321,1055,19,第6題的C,
29,377,1055,21,第6題的D,
30,432,1056,20,第6題的E,
31,215,1118,20,第7題的A,
32,268,1118,20,第7題的B,
33,321,1118,20,第7題的C,
34,375,1118,20,第7題的D,
35,434,1118,20,第7題的E,
36,214,1182,21,第8題的A,
37,267,1181,21,第8題的B,
38,322,1181,19,第8題的C,
39,376,1181,21,第8題的D,
40,431,1179,20,第8題的E,
41,212,1244,20,第9題的A,
42,269,1245,20,第9題的B,
43,324,1244,20,第9題的C,
44,377,1244,19,第9題的D,
45,433,1242,20,第9題的E,
46,215,1308,20,第10題的A,
47,268,1309,20,第10題的B,
48,322,1307,19,第10題的C,
49,377,1307,20,第10題的D,
50,431,1307,19,第10題的E,
51,214,1371,18,第11題的A,
52,266,1371,20,第11題的B,
53,322,1371,20,第11題的C,
54,378,1370,20,第11題的D,
55,432,1371,19,第11題的E,
56,214,1434,19,第12題的A,
57,269,1434,20,第12題的B,
58,323,1434,19,第12題的C,
59,377,1434,18,第12題的D,
60,430,1434,20,第12題的E,
61,212,1497,20,第13題的A,
62,268,1497,18,第13題的B,
63,324,1496,20,第13題的C,
64,379,1498,20,第13題的D,
65,432,1497,20,第13題的E,
66,213,1560,21,第14題的A,
67,268,1561,21,第14題的B,
68,321,1560,20,第14題的C,
69,376,1560,21,第14題的D,
70,432,1559,21,第14題的E,
71,214,1624,21,第15題的A,
72,268,1623,20,第15題的B,
73,322,1624,19,第15題的C,
74,377,1623,19,第15題的D,
75,432,1625,20,第15題的E,
76,214,1687,21,第16題的A,
77,267,1687,21,第16題的B,
78,322,1687,19,第16題的C,
79,377,1687,20,第16題的D,
80,432,1685,20,第16題的E,
81,215,1749,20,第17題的A,
82,267,1750,19,第17題的B,
83,323,1749,19,第17題的C,
84,377,1750,19,第17題的D,
85,433,1749,21,第17題的E,
86,212,1812,20,第18題的A,
87,268,1812,21,第18題的B,
88,323,1812,21,第18題的C,
89,377,1813,19,第18題的D,
90,432,1812,20,第18題的E,
91,214,1876,21,第19題的A,
92,267,1875,20,第19題的B,
93,321,1876,20,第19題的C,
94,377,1876,21,第19題的D,
95,431,1876,21,第19題的E,
96,213,1939,19,第20題的A,
97,268,1941,20,第20題的B,
98,322,1939,19,第20題的C,
99,377,1939,20,第20題的D,
100,432,1939,21,第20題的E,
101,599,740,20,第21題的A,
102,653,737,20,第21題的B,
103,707,738,21,第21題的C,
104,762,739,21,第21題的D,
105,816,737,20,第21題的E,
106,598,803,20,第22題的A,
107,653,803,20,第22題的B,
108,707,802,19,第22題的C,
109,760,802,20,第22題的D,
110,816,801,19,第22題的E,
111,598,863,20,第23題的A,
112,652,864,21,第23題的B,
113,707,865,21,第23題的C,
114,762,865,21,第23題的D,
115,816,864,18,第23題的E,
116,598,927,18,第24題的A,
117,652,927,19,第24題的B,
118,707,928,19,第24題的C,
119,762,928,19,第24題的D,
120,816,927,19,第24題的E,
121,598,989,20,第25題的A,
122,652,991,21,第25題的B,
123,707,991,21,第25題的C,
124,762,989,20,第25題的D,
125,817,990,21,第25題的E,
126,598,1056,20,第26題的A,
127,653,1055,19,第26題的B,
128,709,1055,20,第26題的C,
129,762,1055,21,第26題的D,
130,816,1055,21,第26題的E,
131,598,1117,19,第27題的A,
132,653,1117,21,第27題的B,
133,707,1118,19,第27題的C,
134,762,1116,20,第27題的D,
135,816,1117,21,第27題的E,
136,598,1180,21,第28題的A,
137,652,1181,21,第28題的B,
138,707,1181,21,第28題的C,
139,761,1181,21,第28題的D,
140,816,1179,20,第28題的E,
141,599,1244,19,第29題的A,
142,651,1244,20,第29題的B,
143,707,1243,21,第29題的C,
144,762,1242,20,第29題的D,
145,816,1244,18,第29題的E,
146,598,1307,21,第30題的A,
147,653,1307,21,第30題的B,
148,705,1307,20,第30題的C,
149,762,1307,18,第30題的D,
150,816,1307,18,第30題的E,
151,597,1371,21,第31題的A,
152,653,1371,18,第31題的B,
153,705,1371,20,第31題的C,
154,760,1371,20,第31題的D,
155,815,1371,21,第31題的E,
156,598,1434,18,第32題的A,
157,653,1434,19,第32題的B,
158,705,1434,20,第32題的C,
159,762,1434,18,第32題的D,
160,816,1434,18,第32題的E,
161,597,1497,21,第33題的A,
162,652,1497,19,第33題的B,
163,707,1497,18,第33題的C,
164,762,1497,21,第33題的D,
165,816,1497,18,第33題的E,
166,596,1560,20,第34題的A,
167,653,1560,21,第34題的B,
168,706,1560,21,第34題的C,
169,761,1560,21,第34題的D,
170,816,1558,20,第34題的E,
171,598,1622,20,第35題的A,
172,653,1623,21,第35題的B,
173,707,1624,19,第35題的C,
174,762,1626,21,第35題的D,
175,816,1623,19,第35題的E,
176,598,1688,20,第36題的A,
177,653,1687,19,第36題的B,
178,707,1686,21,第36題的C,
179,762,1687,20,第36題的D,
180,816,1688,20,第36題的E,
181,598,1750,18,第37題的A,
182,653,1750,19,第37題的B,
183,707,1749,21,第37題的C,
184,764,1751,21,第37題的D,
185,816,1750,21,第37題的E,
186,598,1811,20,第38題的A,
187,653,1811,20,第38題的B,
188,707,1812,21,第38題的C,
189,762,1813,19,第38題的D,
190,816,1812,21,第38題的E,
191,596,1876,20,第39題的A,
192,652,1876,21,第39題的B,
193,707,1875,21,第39題的C,
194,761,1875,22,第39題的D,
195,816,1876,21,第39題的E,
196,598,1940,21,第40題的A,
197,652,1938,21,第40題的B,
198,707,1939,21,第40題的C,
199,762,1939,19,第40題的D,
200,817,1939,22,第40題的E,
201,300,446,18,班級十位數0,
202,354,446,21,班級十位數1,
203,409,445,20,班級十位數2,
204,463,445,20,班級十位數3,
205,518,446,19,班級十位數4,
206,572,446,21,班級十位數5,
207,626,447,21,班級十位數6,
208,680,446,21,班級十位數7,
209,736,446,19,班級十位數8,
210,790,446,21,班級十位數9,
211,298,504,20,班級個位數0,
212,353,504,22,班級個位數1,
213,408,503,21,班級個位數2,
214,463,503,21,班級個位數3,
215,518,504,18,班級個位數4,
216,571,502,20,班級個位數5,
217,627,503,21,班級個位數6,
218,681,503,21,班級個位數7,
219,737,503,20,班級個位數8,
220,789,502,20,班級個位數9,
221,298,561,20,座號十位數0,
222,354,561,19,座號十位數1,
223,410,560,20,座號十位數2,
224,463,561,22,座號十位數3,
225,519,561,20,座號十位數4,
226,572,559,20,座號十位數5,
227,627,560,21,座號十位數6,
228,681,560,21,座號十位數7,
229,736,560,21,座號十位數8,
230,790,562,20,座號十位數9,
231,300,619,20,座號個位數0,
232,354,618,21,座號個位數1,
233,408,617,22,座號個位數2,
234,464,619,20,座號個位數3,
235,518,619,20,座號個位數4,
236,572,616,20,座號個位數5,
237,628,618,20,座號個位數6,
238,680,617,21,座號個位數7,
239,737,618,20,座號個位數8,
240,788,617,20,座號個位數9,
241,300,389,21,一年級,
242,354,387,20,二年級,
243,409,387,20,三年級 `;
        function parseBubbles(raw) {
            return raw.trim().split('\n').map(line => {
                const cols = line.split(',');
                return {
                    x: parseInt(cols[1]),
                    y: parseInt(cols[2]),
                    r: parseInt(cols[3]),
                    isMarked: cols[5] === 'true'
                };
            });
        }

        const bubbles = parseBubbles(bubbleDataRaw);

        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    // 設定 Canvas 原始大小為圖片解析度
                    canvas.width = img.width;
                    canvas.height = img.height;
                    
                    // 繪製背景
                    ctx.drawImage(img, 0, 0);
                    
                    // 繪製定位框
                    ctx.strokeStyle = "red";
                    ctx.lineWidth = 4;
                    anchorData.forEach(([name, cx, cy, w, h]) => {
                        ctx.strokeRect(cx - w/2, cy - h/2, w, h);
                    });

                    // 繪製所有泡泡
                    ctx.lineWidth = 2;
                    bubbles.forEach(b => {
                        ctx.beginPath();
                        ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
                        if (b.isMarked) {
                            ctx.fillStyle = "rgba(255, 0, 0, 0.4)";
                            ctx.fill();
                        }
                        ctx.strokeStyle = "red";
                        ctx.stroke();
                    });

                    document.getElementById('infoText').innerText = ` — 解析度: ${img.width}x${img.height} | 已繪製 4 定位點, ${bubbles.length} 泡泡`;
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });
    </script>
</body>
</html>
